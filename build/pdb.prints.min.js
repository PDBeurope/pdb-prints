/**
 * Copyright 2015-2016 Mandar Deshpande <mandar@ebi.ac.uk>
 * European Bioinformatics Institute (EBI, http://www.ebi.ac.uk/)
 * European Molecular Biology Laboratory (EMBL, http://www.embl.de/)
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and 
 * limitations under the License.
 */
!function(){"use strict";angular.module("pdb.prints.filters",[]).filter("printsDataModelFilter",function(){return function(e){var a="",i={PDBeLogo:[],PrimaryCitation:[],Protein:[],Ligands:[],NucleicAcid:[],Expressed:[],Experimental:[],Taxonomy:[]},n=!1,t="",o=!1,r="",s=!1;if(angular.forEach(e.doclist.docs,function(c){if(a=c.pdb_id,i.PDBeLogo[0]=a,i.PrimaryCitation[0]=!angular.isUndefined(c.citation_year)&&c.citation_year?"published":"unpublished",i.Protein[0]=!angular.isUndefined(c.number_of_protein_chains)&&c.number_of_protein_chains?"present":"absent",i.Ligands[0]=!angular.isUndefined(c.number_of_bound_entities)&&c.number_of_bound_entities?"present":"absent",i.NucleicAcid[0]=!angular.isUndefined(c.number_of_RNA_chains)&&c.number_of_RNA_chains||!angular.isUndefined(c.number_of_DNA_chains)&&c.number_of_DNA_chains?"present":"absent",!angular.isUndefined(c.sample_preparation_method)&&c.sample_preparation_method)for(var l=c.sample_preparation_method.length,d=0;l>d;d++)switch(""===t&&(t=c.sample_preparation_method[d]),c.sample_preparation_method[d]!==t&&(n=!0),c.sample_preparation_method[d]){case"Engineered":i.Expressed[0]="expressed";break;case"Synthetic":i.Expressed[0]="synthetic";break;case"Natural":i.Expressed[0]="purified";break;default:i.Expressed[0]="other"}else{var m="",p=new RegExp("Synthetic construct","i");i.Expressed[0]=!angular.isUndefined(c.entry_organism_scientific_name)&&p.test(c.entry_organism_scientific_name)?m="synthetic":"CGIlogoUnknown",i.Expressed[0]!==t&&(n=!0,m="other"),""===t&&(t=m),e.doclist.docs.length>1&&i.Expressed[1]!==t&&(n=!0)}!angular.isUndefined(c.experimental_method)&&c.experimental_method?1===c.experimental_method.length?"x-ray diffraction"===c.experimental_method[0].toLowerCase()?(i.Experimental[0]="xray","y"!==c.experiment_data_available&&(i.Experimental[0]="xrayNoData")):"solution nmr"===c.experimental_method[0].toLowerCase()||"solid-state nmr"===c.experimental_method[0].toLowerCase()?(i.Experimental[0]="nmr","y"!==c.experiment_data_available&&(i.Experimental[0]="nmrNoData")):"electron microscopy"===c.experimental_method[0].toLowerCase()?(i.Experimental[0]="em","y"===c.experiment_data_available||c.emdb_id||(i.Experimental[0]="emNoData")):i.Experimental[0]="other":(i.Experimental[0]="hybrid","y"!==c.experiment_data_available&&(i.Experimental[0]="hybridNoData")):i.Experimental[0]="CGIlogoUnknown";var u={Dinophyceae:"algae",Embryophyta:"plant",Streptophyta:"plant","Saccharomyces cerevisiae":"yeast",Saccharomyces:"yeast",Drosophila:"fly","Gallus gallus":"chicken","Homo sapiens":"human","Sus scrofa":"pig","Bos taurus":"cow","Mus musculus":"mouse",Rattus:"rat",Rat:"rat",Mammalia:"mammal",Fungi:"fungi",Ascomycota:"fungi",Viruses:"virus",Bacteria:"bacteria",Archaea:"archaea",Eukaryota:"eukaryote"},h=function(e){var a=[];return angular.forEach(e,function(e,i){var n=e.toLowerCase().split("|")[0];-1==a.indexOf(n)&&a.push(i)}),a.length>1?!1:!0};if(!angular.isUndefined(c.entry_organism_scientific_name)&&c.entry_organism_scientific_name){if(r=c.entry_organism_scientific_name,c.entry_organism_scientific_name.length>1){var g=h(c.entry_organism_scientific_name);if(0==g)o=!0;else{var b=c.entry_organism_scientific_name[0].split("|")[0];b in u&&(i.Taxonomy[0]=u[b])}}else{var b=c.entry_organism_scientific_name[0].split("|")[0];b in u&&(i.Taxonomy[0]=u[b])}var p=new RegExp("Synthetic construct","i");p.test(c.entry_organism_scientific_name)&&(i.Taxonomy[0]="artificial")}if(!i.Taxonomy[0]&&!angular.isUndefined(typeof c.organism_synonyms)&&c.organism_synonyms){s=!0;for(var f=c.organism_synonyms.length,y=0;f>y;y++)if(c.organism_synonyms[y]in u){i.Taxonomy[0]=u[c.organism_synonyms[y]];break}i.Taxonomy[0]||(i.Taxonomy[0]="other")}}),n&&(i.Expressed[0]="multiple"),"synthetic"===i.Expressed[1]){var c=new RegExp("Synthetic construct","i");(""===r||c.test(r))&&(i.Taxonomy[0]="artificial",s&&(i.Taxonomy[0]="other"))}return o&&(i.Taxonomy[0]="multiple"),i}}).filter("tooltipFilter",function(){return function(e){var a="";switch(e[0]){case"pdbeLogo":a="For more information about key features of this entry, click on the individual icons.";break;case"PrimaryCitation":switch(e[1]){case"published":a="A paper describing this entry has been published.";break;case"unpublished":a="The PDB does not have any information about a published paper describing this entry.";break;case"CGIlogoUnknown":a="This icon conveys information about whether or not a paper describing this entry has been published."}break;case"Taxonomy":switch(e[1]){case"artificial":a="The biomacromolecules in this entry were artificially designed.";break;case"other":a="Information about the source organism of the biomacromolecules in this entry can be obtained by clicking on the icon.";break;case"multiple":a="The biomacromolecules in this entry derive from multiple organisms.";break;case"fly":a="The source organism of the biomacromolecules in this entry is fruit-fly.";break;case"CGIlogoUnknown":a="This icon conveys information about the source organism of the biomacromolecules in this entry.";break;default:a="The source organism of the biomacromolecules in this entry is "+e[1]+"."}break;case"Expressed":switch(e[1]){case"expressed":a="The sample of the biomacromolecules in this entry was obtained by expression and purification.";break;case"synthetic":a="The sample of the biomacromolecules in this entry was obtained by chemical synthesis.";break;case"purified":a="The sample of the biomacromolecules in this entry was extracted and purified from a biological source.";break;case"multiple":a="The sample of the biomacromolecules in this entry was obtained using multiple techniques.";break;case"other":a="The sample of the biomacromolecules in this entry was obtained using techniques other than expression, chemical synthesis or extraction from a biological source.";break;case"CGIlogoUnknown":a="This icon conveys information about the production techniques used to obtain the biomacromolecular samples for this entry."}break;case"Experimental":switch(e[1]){case"xray":a="The structure was determined using X-ray crystallography and experimental data is available.";break;case"nmr":a="The structure was determined using NMR spectroscopy and experimental data is available.";break;case"em":a="The structure was determined using Electron Microscopy and experimental data is available.";break;case"multiple":a="The structure was determined using Electron Crystallography and experimental data is available.";break;case"extal":a="The sample of the biomacromolecules in this entry was obtained using techniques other than expression, chemical synthesis or extraction from a biological source.";break;case"hybrid":a="The structure was determined using a hybrid technique and experimental data is available.";break;case"other":a="The structure was determined using a technique other than X-ray, NMR, EM, or a hybrid thereof and experimental data is available.";break;case"xrayNoData":a="The structure was determined using X-ray crystallography (no experimental data available).";break;case"nmrNoData":a="The structure was determined using NMR spectroscopy (no experimental data available).";break;case"emNoData":a="The structure was determined using Electron Microscopy (no experimental data available).";break;case"extalNoData":this.title="The structure was determined using Electron Crystallography (no experimental data available).";break;case"hybridNoData":a="The structure was determined using a hybrid technique (no experimental data available).";break;case"otherNoData":a="The structure was determined using a technique other than X-ray, NMR, EM, or a hybrid thereof (no experimental data available).";break;case"extalNoData":a="This icon conveys information about the structure-determination technique for this entry."}break;case"Protein":switch(e[1]){case"present":a="This entry contains protein.";break;case"absent":a="This entry does not contain protein.","EMD"===e[2].substring(0,3)&&(this.title="Presence of protein is not annotated for this EMDB entry.");break;case"CGIlogoUnknown":a="This icon conveys information about the presence of protein in the entry."}break;case"NucleicAcid":switch(e[1]){case"present":a="This entry contains nucleic acid (DNA, RNA).";break;case"absent":a="This entry does not contain nucleic acid (DNA, RNA).","EMD"===e[2].substring(0,3)&&(a="Presence of DNA or RNA is not annotated for this EMDB entry.");break;case"CGIlogoUnknown":a="This icon conveys information about the presence of nucleic acid (DNA, RNA) in the entry."}break;case"Ligands":switch(e[1]){case"present":a="This entry contains one or more ligands.";break;case"absent":a="This entry does not contain any ligands.";break;case"CGIlogoUnknown":a="This icon conveys information about the presence of ligands in the entry."}}return a}})}(),function(){"use strict";angular.module("pdb.prints.services",[]).service("printsService",["$http","$q",function(e,a){this.getPrintsData=function(i){var n="//www.ebi.ac.uk/pdbe/search/pdb/select?",t="fl=pdb_id,organism_synonyms,number_of_bound_entities%2C+number_of_protein_chains%2Cexperimental_method%2C+experiment_data_available%2Cexpression_host_sci_name%2C+citation_year%2C+entry_organism_scientific_name,number_of_RNA_chains,number_of_DNA_chains,sample_preparation_method,emdb_id",o="&group=true&group.field=pdb_id&group.limit=100&rows=1000",r="&wt=json",s="&q=pdb_id:("+i.join(" OR ")+")",c=n+t+o+r+s,l=a.defer();return e.get(c).then(function(e){l.resolve(e.data)},function(){l.reject("fail response")}),l.promise}}])}(),function(){"use strict";angular.module("pdb.prints",["pdb.prints.filters","pdb.prints.services","template/prints/pdbLogos.html"]).directive("pdbPrints",["printsService","$compile","$filter",function(e,a,i){return{restrict:"EAC",scope:{pdbIds:"=",settings:"@"},link:function(n,t){n.config={picstype:"jslogos",orientation:"horizontal",size:36,color:"embl_green",targetWindow:"_self",domainUrl:"//www.ebi.ac.uk/pdbe",hideLogo:[]},"undefined"!=typeof n.settings&&n.settings&&angular.extend(n.config,JSON.parse(n.settings));for(var o=[],r=20,s=n.pdbIds.slice();s.length>0;)o.push(s.splice(0,r));angular.forEach(o,function(o){var r=angular.element(document.getElementsByClassName("pdbprints_"+o[0]));r.length&&r.html("PDBprints loading....");e.getPrintsData(o).then(function(e){angular.isUndefined(e.responseHeader.error)?!angular.isUndefined(e.grouped.pdb_id.groups)&&e.grouped.pdb_id.groups&&angular.forEach(e.grouped.pdb_id.groups,function(e){var o=i("printsDataModelFilter")(e,n.config),r="<pdb-logos logo-data='"+JSON.stringify(o)+'\' config-data="config" click-action="'+n.clickAction+'"></pdb-logos>',s=a(r)(n),c=angular.element(t[0].querySelector(".pdbprints_"+o.PDBeLogo[0]));c.length?c.html("").append(s):t.append(s)}):window.console&&console.log("Error data in API response. Error: "+e.responseHeader.error)},function(e){window.console&&console.log("API request failed. Error: "+e)})})}}}]).directive("pdbLogos",["printsService","$filter",function(){return{restrict:"EA",scope:{logoData1:"@logoData",config:"=configData"},templateUrl:"template/prints/pdbLogos.html",link:function(e){e.logoData=JSON.parse(e.logoData1),e.categories=["PrimaryCitation","Taxonomy","Expressed","Experimental","Protein","NucleicAcid","Ligands"],e.categoryUrl=["/citations","/analysis","/analysis","/experiment","/analysis","/analysis","/ligands"]}}}])}(),angular.module("template/prints/pdbLogos.html",[]).run(["$templateCache",function(e){e.put("template/prints/pdbLogos.html",'<div class="pdbLogosWrapper"><div class="widthAuto" ng-class="{\'floatLeft\': config.orientation != \'vertical\'}" style="height:{{config.size}}px;position:relative;" ng-hide="(config.hideLogo.indexOf(\'PDBeLogo\') > -1)"><div class="pdbeLogoCol pdbeLogoCol1" style="font-size:{{ (config.size * 4) / (12-1) }}px"><a target="_self" title="{{ [\'pdbeLogo\'] | tooltipFilter }}"href="{{config.domainUrl}}/entry/pdb/{{logoData.PDBeLogo[0]}}/" ng-click="logoClick(\'pdbeLogo\')"><font face="Courier New"><b>{{logoData.PDBeLogo[0]}}</b></font></a></div><div class="pdbeLogoCol1Bottom"><a target="{{config.targetWindow}}" title="pdbe.org" href="{{config.domainUrl}}"><img border="0" ng-src="//www.ebi.ac.uk/pdbe/widgets/html/PDBeWatermark_horizontal_{{config.size}}.png"></a></div></div><div ng-repeat="category in categories" class="pdbeLogoCol widthAuto" ng-class="{\'floatLeft\': config.orientation != \'vertical\'}" ng-hide="(config.hideLogo.indexOf(category) > -1)" style="height:{{config.size}}px"><a target="pdbprints" ng-attr-title="{{ [ category, logoData[category][0], logoData.PDBeLogo[0] ] | tooltipFilter }}" href="{{config.domainUrl}}/entry/pdb/{{logoData.PDBeLogo[0]}}{{categoryUrl[$index]}}"><img class="pdbLogoImg" ng-src="{{config.domainUrl}}/widgets/pdblogos/{{config.color}}/{{config.size}}/{{category}}_{{logoData[category][0]}}.png" border="0"></a></div></div>')}]);